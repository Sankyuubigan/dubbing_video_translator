# VideoTranslator
Перевод видео с английского на русский

Пояснения к структуре и коду:

    video_processor.py: Содержит функции для работы с медиа через FFmpeg (извлечение/замена аудио, добавление субтитров, извлечение клипов, объединение аудио). Добавлена проверка доступности ffmpeg и ffprobe.

    transcriber.py: Загружает модели whisperx (STT и Diarization), выполняет транскрибацию и диаризацию. Добавлена обработка Hugging Face токена (через переменную окружения HF_TOKEN или параметр use_auth_token, если вы решите его передавать). Реализовано кэширование моделей. Добавлен фолбэк на случай ошибки диаризации.

    translator.py: Загружает модель перевода Helsinki-NLP и переводит тексты сегментов. Реализовано кэширование и пакетный перевод с фолбэком на одиночный.

    voice_cloner.py: Загружает модель Coqui TTS XTTS-v2. Функция synthesize_speech_segments выполняет основную логику: находит референсные клипы для каждого спикера (find_best_speaker_clip, который вызывает video_processor.extract_speaker_clip), синтезирует речь для каждого сегмента с использованием нужного референса (tts.tts_to_file) и объединяет полученные аудиосегменты (video_processor.merge_audio_segments). Реализовано кэширование TTS модели и добавление тишины между сегментами.


Клонирование голосов:

    Да, в коде, который я прислал в прошлый раз, уже реализована логика клонирования голоса.

    Как работает:

        Модуль transcriber.py (используя whisperx) определяет, кто говорит и когда (диаризация).

        Модуль voice_cloner.py для каждого уникального спикера находит короткий (3-8 секунд) "чистый" фрагмент его речи в исходном аудиофайле (функция find_best_speaker_clip).

        При синтезе речи для каждого переведенного сегмента с помощью TTS (Coqui XTTS-v2), он передает путь к этому референсному аудиофрагменту спикера в параметр speaker_wav функции tts.tts_to_file().

        Модель XTTS-v2 использует этот короткий образец для клонирования тембра и интонаций оригинального спикера при генерации русской речи. Это называется zero-shot voice cloning (клонирование по одному образцу без дообучения).