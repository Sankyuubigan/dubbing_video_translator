# Video Dubbing Tool (WhisperX + XTTS)

Этот инструмент предназначен для автоматического дубляжа видео на другой язык (в данный момент, с английского на русский) с использованием современных технологий машинного обучения. 

Входные данные:
    Видео: ссылка на YouTube (предположительно с английским аудио) или локальный видеофайл.
    Субтитры (опционально):
        Локальный SRT/VTT файл (предпочтительно русский, с текстом и временами).
        ИЛИ программа попытается скачать субтитры с YouTube (сначала русские, потом английские), если локальный файл не указан и это YouTube видео.

# алгоритм программы:
1. подготовка субтитров:
    - если субтитры есть:
        * метод _postprocess_srt_segments будет делать корректировку уже существующих временные метки в списке сегментов, чтобы тайминги шли последовательно.
        * диаризация субтитров через виспер - определение спикеров
        * распознаётся язык субтитров через лангдетект. если англ то перевод на рус яз. через хельсинки.
    - если субтитров нет:
        * извлечение аудиодорожки
        * получение англ субтитров через виспер транскрибирование , с временными метками. + выравнивание виспера
        * диаризация субтитров через виспер - определение спикеров
        * перевод субтитров на рус язык
2. синтез речи:
    * Синтезировать русскую речь для каждого сегмента SRT, используя клонированный голос соответствующего спикера.
    * Подогнать длительность синтезированной речи под длительность, указанную в вашем русском SRT.
    * Собрать аудио с новой русской аудиодорожкой из всех сегментов.
3. Сборка видео: Замена оригинальной аудиодорожки на новую, смикшированную (оригинальное аудио с пониженной громкостью + дублированное аудио).




## Основные возможности

*   **Извлечение аудио:** Автоматическое извлечение аудиодорожки из видеофайла.
*   **Транскрипция:** Преобразование речи из аудио в текст с использованием `WhisperX` (модель `medium.en`).
*   **Диаризация:** Определение говорящих (кто говорит в какой момент времени) с помощью `pyannote.audio`.
*   **Перевод:** Перевод транскрибированного текста с английского на русский язык с использованием модели `Helsinki-NLP/opus-mt-en-ru` из библиотеки `transformers`.
*   **Синтез речи (Дубляж):** Озвучивание переведенного текста с клонированием голоса оригинальных спикеров с помощью модели `Coqui XTTS-v2`.
*   


## Используемые технологии

*   **Python 3.11+**
*   **Tkinter** для графического интерфейса пользователя (GUI).
*   **WhisperX** для точной транскрипции и выравнивания временных меток.
*   **pyannote.audio** для диаризации говорящих.
*   **Hugging Face Transformers** (Helsinki-NLP) для машинного перевода.
*   **Coqui TTS (XTTS-v2)** для высококачественного синтеза речи и клонирования голоса.
*   **FFmpeg** для всех операций с аудио/видео (извлечение, микширование, добавление субтитров, сборка).
*   **PyTorch** как основная библиотека для моделей машинного обучения.
*   **pipreqs** для автоматической генерации файла `requirements.txt`.
*   **pre-commit** для автоматизации проверки и генерации `requirements.txt` перед коммитом.

## Установка и запуск

1.  **Клонировать репозиторий:**
    ```bash
    git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
    cd video_translator-main
    python -m venv .venv
    # Для Windows:
    .\.venv\Scripts\activate
    # Для Linux/macOS:
    # source .venv/bin/activate
    pip install -r requirements.txt
    pip install pipreqs # Если еще не установлен и хук будет ругаться
    python main.py
video_translator-main/
├── .venv/                     # Виртуальное окружение (игнорируется Git)
├── .gitignore                 # Файлы, игнорируемые Git
├── .pre-commit-config.yaml    # Конфигурация pre-commit хуков
├── main.py                    # Основной файл приложения, GUI и логика управления
├── README.md                  # Этот файл
├── requirements.txt           # Зависимости проекта (генерируется)
├── todo.md                    # Список задач (если есть)
├── transcriber.py             # Модуль для транскрипции и диаризации
├── translator.py              # Модуль для перевода текста
├── video_processor.py         # Модуль для обработки видео и аудио (FFmpeg)
└── voice_cloner.py            # Модуль для синтеза речи и клонирования голоса