repos:
-   repo: local
    hooks:
    -   id: requirements
        name: Generate requirements.txt
        entry: |
            bash -c '
            set -ex # Выход при ошибке и печать команд

            echo "--- Debugging requirements.txt hook (Git Bash Env) ---"
            echo "Current working directory:"
            pwd
            
            # Основной путь для venv, созданного на Windows, но используемого из Git Bash
            TARGET_PYTHON="./.venv/Scripts/python.exe"

            echo "Assigned TARGET_PYTHON is: ${TARGET_PYTHON}"

            echo "Listing TARGET_PYTHON with ls -la:"
            ls -la "${TARGET_PYTHON}" # Эта команда должна показать файл, если он есть

            echo "Attempting to execute: ${TARGET_PYTHON} --version"
            
            if ! "${TARGET_PYTHON}" --version > /dev/null 2>&1; then
                echo "Error: Command '\''${TARGET_PYTHON} --version'\'' failed."
                echo "Exit code of the command was: $?"
                
                # Дополнительная проверка bash-совместимыми командами
                if [ -f "${TARGET_PYTHON}" ]; then
                    echo "Bash check: File '\''${TARGET_PYTHON}'\'' exists."
                    if [ -x "${TARGET_PYTHON}" ]; then
                        echo "Bash check: File '\''${TARGET_PYTHON}'\'' is executable."
                    else
                        echo "Bash check: File '\''${TARGET_PYTHON}'\'' is NOT executable (check permissions or if it is a valid exe for this bash)."
                    fi
                else
                    echo "Bash check: File '\''${TARGET_PYTHON}'\'' does NOT exist (checked after failure)."
                fi
                echo "Please ensure .venv is in project root and contains Scripts/python.exe"
                exit 1
            fi

            echo "Python found and executable. Using: ${TARGET_PYTHON}"
            "${TARGET_PYTHON}" -m pip freeze --local > requirements.txt && git add requirements.txt
            echo "requirements.txt generated and added."
            echo "---------------------------------------"
            '
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]